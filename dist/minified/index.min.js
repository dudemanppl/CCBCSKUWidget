const t=window.location.search,e=new URLSearchParams(t),n=!!e.getAll("activity")[0],o="www.competitivecyclist.com"===window.location.host,r=o?"cc":"bc",c=document.querySelectorAll('[data-id="productListingItems"]').length,s=document.getElementsByClassName("js-kraken-pdp-body").length;chrome.runtime.sendMessage({onCompetitiveCyclist:o});const i=(t,e,n,o)=>{const r=document.createElement(t);if(e){if(!Array.isArray(e))throw new TypeError("Expected an array");r.classList.add(...e)}return n&&(r.id=n),o&&(r.textContent=o),r},a=t=>{const e=i("a",l("WMSLink"),null,"Go to WMS");return e.setAttribute("type","button"),e.href=`https://manager.backcountry.com/manager/admin/item_inventory.html?item_id=${t}`,e},l=t=>{const e=[r],n=(...t)=>{e.push(...t)};return"WMSLink"!==t&&"CopySKUButton"!==t||(n("btn","btn-reset"),s?(n("pdp"),n(o?"btn--secondary":"product-buybox__btn")):n("plp")),"WMSLink"===t&&n("link-to-wms"),"PLPPrice"===t&&n("ui-pl-pricing__high-price","ui-pl-pricing--price-retail","js-item-price-high","qa-item-price-high"),e},d=({currentTarget:t})=>{const e=document.getElementsByClassName("js-selected-product-variant")[0].value;e?(navigator.clipboard.writeText(e),t.textContent="Copied!",t.classList.add("flash"),setTimeout((()=>{t.classList.remove("flash")}),100)):(t.textContent="Choose Item",t.classList.add("no-variant-selected"))},p=({currentTarget:t})=>{t.textContent="Copy SKU",t.classList.remove("no-variant-selected")},u=t=>{t.onmouseleave=p,t.onclick=d},m=()=>{const t=i("button",l("CopySKUButton"),"copy-sku-button","Copy SKU");return t.setAttribute("type","button"),u(t),t},y=()=>{for(const t of document.getElementsByClassName("js-unifiedropdown-option")){const e=t.getAttribute("sku-value");e&&!BC.product.skusCollection[e].inventory&&t.classList.add("oos-alert")}},g=t=>t.toString().slice(5,-1),v=t=>{const e=i("script",null,null,g(t));document.head.append(e),e.remove()},w=()=>{const[t]=document.getElementsByClassName(o?"add-to-cart":"js-buybox-actions");return t},S=()=>{const{value:t}=document.querySelector('[name ="/atg/commerce/order/purchase/CartModifierFormHandler.productId"]');return t};s&&(o&&v(y),w().append(a(S()),m()));const h=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("dropdown-caret"),o&&t.classList.add("cc"),t.setAttribute("viewBox","0 0 256 256");const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("d","M203.628 107.72c-5.613 5.9-64.759 63.566-64.759 63.566-3.007 3.149-6.939 4.714-10.87 4.714-3.945 0-7.876-1.567-10.87-4.714 0 0-59.145-57.665-64.773-63.565-5.613-5.9-6-16.501 0-22.812 6.014-6.296 14.386-6.79 21.738 0l53.905 52.908 53.891-52.894c7.365-6.79 15.752-6.296 21.738 0 6.014 6.296 5.641 16.912 0 22.797z"),e.classList.add("caret-path"),t.append(e),t},b=({classList:[t]})=>"plp-dropdown-options"===t,L=async({currentTarget:t},e,n,o)=>{const{firstChild:c,lastChild:s}=t;if(b(s))s.classList.toggle("hidden");else{const s=i("UL",["plp-dropdown-options","hidden",r]);t.append(s),s.replaceWith(await K(e,c,n,o))}},C=t=>{t.classList.add("hidden")},k=t=>{const[e]=t.getElementsByTagName("img"),[n]=t.getElementsByClassName("ui-pl-pricing");return[e,n]},f=(t,e,n,o)=>{const[r,c]=k(e);n.onclick=e=>L(e,t,[r,c],o),e.onmouseleave=()=>{o.variantImgSrc&&(r.src=o.variantImgSrc);const[t]=e.getElementsByClassName("plp-dropdown-options");t&&t.classList.add("hidden")}},x=()=>i("div",["plp-dropdown-curr-selected-variant",r],null,"Select option"),I=(t,e)=>{const n=i("div",["plp-dropdown-container",r]);return n.append(i("div",["plp-dropdown-curr-selected-variant",r],null,"Select option"),h()),f(t,e,n,{variantSelected:!1,currentlySelectedOptionIdx:-1,variantImgSrc:null}),n},U=async t=>(await fetch(t)).json(),E=async t=>{const e=`https://api.backcountry.com/v1/products/${t}?fields=skus.availability.stockLevel,skus.title,skus.id,skus.salePrice,skus.image&site=${o?"competitivecyclist":"bcs"}`;return await U(e)},N=async t=>{const e=await E(t),{products:[{skus:n}]}=e;return n},B=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t),A=({salePrice:t,id:e,availability:{stockLevel:n},title:r,image:{url:c}})=>{var s;return{price:(s=t,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(s)),SKU:e,outOfStock:!n,variant:r,imageSrc:`https://content.${o?"competitivecyclist":"backcountry"}.com${c}`}},T=(t,e)=>{t.childNodes[e.currentlySelectedOptionIdx].classList.toggle("curr-selected-option")},M=(t,e,n)=>{n!==e.currentlySelectedOptionIdx&&(e.currentlySelectedOptionIdx>=0&&T(t,e),e.currentlySelectedOptionIdx=n,T(t,e))},O=async(t,e,n,o,r)=>(await N(t)).map(((t,c)=>q(A(t),o,e,n,(()=>M(r,o,c))))),K=async(...t)=>{const e=i("ul",["plp-dropdown-options",r]),n=await O(...t,e);return e.append(...n),e},$=(t,e,n)=>{navigator.clipboard.writeText(n),t.classList.toggle("copy-notif"),t.textContent="SKU Copied!",setTimeout((()=>{t.classList.toggle("copy-notif"),t.textContent=e}),300)},j=(t,{price:e,SKU:n,outOfStock:o,variant:r,imageSrc:c},s,i,[a,l],d)=>{o&&t.classList.add("oos-alert"),t.onmouseenter=()=>{a.src!==c&&(a.src=c)},t.onclick=()=>{d(),$(i,r,n),s.variantImgSrc=c}},q=(t,...e)=>{const{variant:n,price:o}=t,r=i("li",["plp-dropdown-option-single"],null,`${n} (${o})`);return j(r,t,...e),r},P=(t,e)=>{const n=i("div",["plp-widget-container",r]);return n.append(I(t,e),a(t)),n},W=t=>{const e=t.querySelector("img").src,n=o?60:53,r=[n,n+7],c=e.slice(...r),s=t.lastChild;s.append(P(c,s))},_=()=>{const t=document.querySelectorAll('[data-id="productListingItems"]');for(const e of t)W(e)};if(c||n){_();const t=document.querySelector('[data-id="productsWrap"]');new MutationObserver((()=>_())).observe(t,{childList:!0})}