const t=window.location.search,e=new URLSearchParams(t),n=!!e.getAll("activity")[0],s="www.competitivecyclist.com"===window.location.host,o=s?"cc":"bc",r=document.getElementsByClassName("search-results").length,i=document.getElementsByClassName("js-kraken-pdp-body").length;chrome.runtime.sendMessage({onCompetitiveCyclist:s});const c=(t,e,n,s)=>{const o=document.createElement(t);if(e){if(!Array.isArray(e))throw new TypeError("Expected an array");o.classList.add(...e)}return n&&(o.id=n),s&&(o.textContent=s),o},a=t=>{const e=c("a",l("WMSLink"),null,"Go to WMS");return e.setAttribute("type","button"),e.href="https://manager.backcountry.com/manager/admin/item_inventory.html?item_id="+t,e},l=t=>{const e=[o],n=(...t)=>{e.push(...t)};return"WMSLink"!==t&&"CopySKUButton"!==t||(n("btn","btn-reset"),i?(n("pdp"),n(s?"btn--secondary":"product-buybox__btn")):n("plp")),"WMSLink"===t&&n("link-to-wms"),"PLPPrice"===t&&n("ui-pl-pricing__high-price","ui-pl-pricing--price-retail","js-item-price-high","qa-item-price-high"),e},d=({currentTarget:t})=>{const e=document.getElementsByClassName("js-selected-product-variant")[0].value;e?(navigator.clipboard.writeText(e),t.textContent="Copied!",t.classList.add("flash"),setTimeout(()=>{t.classList.remove("flash")},100)):(t.textContent="Choose Item",t.classList.add("no-variant-selected"))},p=({currentTarget:t})=>{t.textContent="Copy SKU",t.classList.remove("no-variant-selected")},u=t=>{t.onmouseleave=p,t.onclick=d},m=()=>{const t=c("button",l("CopySKUButton"),"copy-sku-button","Copy SKU");return t.setAttribute("type","button"),u(t),t},g=()=>{for(const t of document.getElementsByClassName("js-unifiedropdown-option")){const e=t.getAttribute("sku-value");e&&!BC.product.skusCollection[e].inventory&&t.classList.add("oos-alert")}},y=t=>t.toString().slice(5,-1),v=t=>{const e=c("script",null,null,y(t));document.head.append(e),e.remove()},h=()=>{const[t]=document.getElementsByClassName(s?"add-to-cart":"js-buybox-actions");return t},w=()=>{const{value:t}=document.querySelector('[name ="/atg/commerce/order/purchase/CartModifierFormHandler.productId"]');return t};i&&(s&&v(g),h().append(a(w()),m()));const S=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("bc-dropdown-caret"),t.setAttribute("viewBox","0 0 256 256");const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("d","M203.628 107.72c-5.613 5.9-64.759 63.566-64.759 63.566-3.007 3.149-6.939 4.714-10.87 4.714-3.945 0-7.876-1.567-10.87-4.714 0 0-59.145-57.665-64.773-63.565-5.613-5.9-6-16.501 0-22.812 6.014-6.296 14.386-6.79 21.738 0l53.905 52.908 53.891-52.894c7.365-6.79 15.752-6.296 21.738 0 6.014 6.296 5.641 16.912 0 22.797z"),e.classList.add("caret-path"),t.append(e),t},b=({classList:[t]})=>"plp-dropdown-options"===t,C=async({currentTarget:t},e,n,s)=>{const{firstChild:r,lastChild:i}=t;if(b(i))i.classList.toggle("hidden");else{const i=c("UL",["plp-dropdown-options","hidden",o]);t.append(i),i.replaceWith(await M(e,r,n,s))}},f=t=>{t.classList.add("hidden")},L=t=>{const[e]=t.getElementsByTagName("img"),[n]=t.getElementsByClassName("js-pl-pricing");return[e,n]},k=(t,e,n,s)=>{const[o,r]=L(e);n.onclick=e=>C(e,t,[o,r],s),e.onmouseleave=()=>{s.variantImgSrc&&(o.src=s.variantImgSrc);const[t]=e.getElementsByClassName("plp-dropdown-options");t&&t.classList.add("hidden")}},x=()=>c("div",["plp-dropdown-curr-selected-variant",o],null,"Select option"),E=(t,e)=>{const n=c("div",["plp-dropdown-container",o]);return n.append(c("div",["plp-dropdown-curr-selected-variant",o],null,"Select option")),s||n.append(S()),k(t,e,n,{variantSelected:!1,currentlySelectedOptionIdx:-1,variantImgSrc:null}),n},N=async t=>(await fetch(t)).json(),B=async t=>{const e=`https://api.backcountry.com/v1/products/${t}?fields=skus.availability.stockLevel,skus.title,skus.id,skus.salePrice,skus.image&site=${s?"competitivecyclist":"bcs"}`;return await N(e)},j=async t=>{const e=await B(t),{products:[{skus:n}]}=e;return n},I=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t),U=({salePrice:t,id:e,availability:{stockLevel:n},title:o,image:{url:r}})=>{var i;return{price:(i=t,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(i)),SKU:e,outOfStock:!n,variant:o,imageSrc:`https://content.${s?"competitivecyclist":"backcountry"}.com${r}`}},A=(t,e)=>{t.childNodes[e.currentlySelectedOptionIdx].classList.toggle("curr-selected-option")},P=(t,e,n)=>{n!==e.currentlySelectedOptionIdx&&(e.currentlySelectedOptionIdx>=0&&A(t,e),e.currentlySelectedOptionIdx=n,A(t,e))},T=async(t,e,n,s,o)=>(await j(t)).map((t,r)=>$(U(t),s,e,n,()=>P(o,s,r))),M=async(...t)=>{const e=c("ul",["plp-dropdown-options",o]),n=await T(...t,e);return e.append(...n),e},O=(t,e,n)=>{const{variantSelected:s}=e;if(t.firstChild.textContent!==n&&s)t.firstChild.textContent=n;else if(!s){for(;t.lastChild;)t.lastChild.remove();t.append(c("span",l("PLPPrice"),null,n)),e.variantSelected=!0}},_=(t,e,n)=>{navigator.clipboard.writeText(n),t.classList.toggle("copy-notif"),t.textContent="SKU Copied!",setTimeout(()=>{t.classList.toggle("copy-notif"),t.textContent=e},300)},K=(t,{price:e,SKU:n,outOfStock:s,variant:o,imageSrc:r},i,c,[a,l],d)=>{s&&t.classList.add("oos-alert"),t.onmouseenter=()=>{a.src!==r&&(a.src=r)},t.onclick=()=>{d(),O(l,i,e),_(c,o,n),i.variantImgSrc=r}},$=(t,...e)=>{const{variant:n,price:s}=t,o=c("li",["plp-dropdown-option-single"],null,`${n} (${s})`);return K(o,t,...e),o},F=(t,e)=>{const n=[...document.getElementsByClassName(t)];for(const t of n)e(t)},W=t=>{F(t,t=>t.remove())},D=()=>{W("ui-pl-info"),W("js-pl-color-thumbs"),W("js-pl-sizes-wrap")},z=(t,e)=>{const n=c("div",["plp-widget-container",o]);return n.append(E(t,e),a(t)),n},q=t=>{const e=t.getAttribute("data-product-id"),n=t.firstChild;n.append(z(e,n))},G=()=>{s||(W("ui-pl-info"),W("js-pl-color-thumbs"),W("js-pl-sizes-wrap")),F(n?"ui-product-listing":"js-product-listing",q)},H=()=>{const[t]=document.getElementsByClassName(s?"js-inner-body":n?"product-listing__wrapper":"inner-body");return t};(r||n)&&(G(),new MutationObserver(()=>G()).observe(H(),{childList:!0}));