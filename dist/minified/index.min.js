const onCompetitiveCyclist=window.location.host==="www.competitivecyclist.com";const siteString=onCompetitiveCyclist?"cc":"bc";const onPLP=document.getElementsByClassName("search-results").length;const onPDP=document.getElementsByClassName("js-kraken-pdp-body").length;chrome.runtime.sendMessage({onCompetitiveCyclist:onCompetitiveCyclist});const HTMLElem=(tagName,classList,id,textContent)=>{const newHTMLElem=document.createElement(tagName);if(classList){newHTMLElem.classList.add(...classList)}if(id){newHTMLElem.id=id}if(textContent){newHTMLElem.textContent=textContent}return newHTMLElem};const WMSLink=productID=>{const newWMSLink=HTMLElem("a",classnamesForElem("WMSLink"),null,"Go to WMS");newWMSLink.setAttribute("type","button");newWMSLink.href=`https://manager.backcountry.com/manager/admin/item_inventory.html?item_id=${productID}`;return newWMSLink};const classnamesForElem=elem=>{const classnames=[siteString];const add=(...classes)=>{classnames.push(...classes)};add("btn","btn-reset");if(onPDP){if(onCompetitiveCyclist){add("btn--secondary")}else{add("product-buybox__btn")}}if(elem==="WMSLink"){add("link-to-wms");if(onPDP){add("pdp")}else{add("plp")}}return classnames};const copySKUButtonOnClick=({currentTarget:button})=>{const SKU=document.getElementsByClassName("js-selected-product-variant")[0].value;if(SKU){navigator.clipboard.writeText(SKU);button.textContent="Copied!";button.classList.add("flash");setTimeout(()=>{button.classList.remove("flash")},100)}else{button.textContent="Choose Item";button.classList.add("no-variant-selected")}};const copySKUButtonOnMouseLeave=({currentTarget:button})=>{button.textContent="Copy SKU";button.classList.remove("no-variant-selected")};const addMethodsToCopySKUButton=copySKUButton=>{copySKUButton.onmouseleave=copySKUButtonOnMouseLeave;copySKUButton.onclick=copySKUButtonOnClick};const copySKUButton=()=>{const newCopySKUButton=HTMLElem("button",classnamesForElem("CopySKUButton"),"copy-sku-button","Copy SKU");newCopySKUButton.setAttribute("type","button");addMethodsToCopySKUButton(newCopySKUButton);return newCopySKUButton};const addOOSAlertToCCPDP=()=>{const scriptToInject=`\n    for (const variant of document.getElementsByClassName(\n      "js-unifiedropdown-option"\n    )) {\n      const SKU = variant.getAttribute("sku-value");\n      SKU &&\n        !BC.product.skusCollection[SKU].inventory &&\n        variant.classList.add("oos-alert");\n    }`;const scriptElem=HTMLElem("script",null,null,scriptToInject);document.head.append(scriptElem);scriptElem.remove()};const PDPTargetLocation=()=>document.getElementsByClassName(onCompetitiveCyclist?"add-to-cart":"js-buybox-actions")[0];const PDPProductID=()=>document.querySelector('[name ="/atg/commerce/order/purchase/CartModifierFormHandler.productId"]').value;if(onPDP){if(onCompetitiveCyclist)addOOSAlertToCCPDP();PDPTargetLocation().append(WMSLink(PDPProductID()),copySKUButton())}const BCDropdownCaret=()=>{const newBCDropdownCaret=document.createElementNS("http://www.w3.org/2000/svg","svg");newBCDropdownCaret.classList.add("bc-dropdown-caret");newBCDropdownCaret.setAttribute("viewBox","0 0 256 256");const svgPath=document.createElementNS("http://www.w3.org/2000/svg","path");svgPath.setAttribute("d","M203.628 107.72c-5.613 5.9-64.759 63.566-64.759 63.566-3.007 3.149-6.939 4.714-10.87 4.714-3.945 0-7.876-1.567-10.87-4.714 0 0-59.145-57.665-64.773-63.565-5.613-5.9-6-16.501 0-22.812 6.014-6.296 14.386-6.79 21.738 0l53.905 52.908 53.891-52.894c7.365-6.79 15.752-6.296 21.738 0 6.014 6.296 5.641 16.912 0 22.797z");svgPath.classList.add("caret-path");newBCDropdownCaret.append(svgPath);return newBCDropdownCaret};const PLPSelectorDropdownContainer=(productID,productListing)=>{const newPLPSelectorDropdownContainer=HTMLElem("div",["plp-dropdown-container",siteString]);const currentOption=HTMLElem("div",["plp-dropdown-current-option",siteString],null,"Select option");newPLPSelectorDropdownContainer.append(...[currentOption,...[!onCompetitiveCyclist?BCDropdownCaret():[]]]);let dropdownOptions;newPLPSelectorDropdownContainer.onclick=e=>{if(onCompetitiveCyclist)e.stopPropagation();if(dropdownOptions){dropdownOptions.classList.toggle("hidden")}else{dropdownOptions=PLPSelectorDropdown(productID,currentOption,productListing);newPLPSelectorDropdownContainer.append(dropdownOptions)}};productListing.onmouseleave=()=>{if(dropdownOptions){dropdownOptions.classList.add("hidden")}};return newPLPSelectorDropdownContainer};const getItemInfo=async productID=>{try{let res=await fetch(`https://api.backcountry.com/v1/products/${productID}?fields=skus.availability.stockLevel,skus.title,skus.id,skus.salePrice,skus.image&site=${onCompetitiveCyclist?"competitivecyclist":"bcs"}`);res=await res.json();return Promise.resolve(await res.products[0].skus)}catch(err){console.log(err)}};const PLPSelectorDropdown=(productID,currentOption,productListing)=>{const newPLPSelectorDropdown=HTMLElem("ul",["plp-dropdown-options",siteString]);const state={variantSelected:false};let currentlySelectedOptionIdx;const highlightCurrSelectedOption=selectedIdx=>{const toggleCurrOptionClass=()=>{newPLPSelectorDropdown.childNodes[currentlySelectedOptionIdx].classList.toggle("curr-selected-option")};if(currentlySelectedOptionIdx>=0){toggleCurrOptionClass()}currentlySelectedOptionIdx=selectedIdx;toggleCurrOptionClass()};getItemInfo(productID).then(products=>{const productListingImg=productListing.getElementsByTagName("img")[0];const productListingPrice=productListing.getElementsByClassName("js-pl-pricing")[0];for(let i=0;i<products.length;i+=1){const currProduct=products[i];const product={price:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(currProduct.salePrice),SKU:currProduct.id,outOfStock:!currProduct.availability.stockLevel,variant:currProduct.title,imageSrc:currProduct.image.url};newPLPSelectorDropdown.append(PLPSelectorDropdownOption(product,state,currentOption,productListingImg,productListingPrice,()=>highlightCurrSelectedOption(i)))}});return newPLPSelectorDropdown};const PLPSelectorDropdownOption=({price:price,SKU:SKU,outOfStock:outOfStock,variant:variant,imageSrc:imageSrc},props,currentOption,productListingImg,productListingPrice,highlightCurrSelectedOption)=>{const newPLPSelectorDropdownOption=HTMLElem("li",["plp-dropdown-option-single"],null,`${variant} (${price})`);if(outOfStock)newPLPSelectorDropdownOption.classList.add("oos-alert");const newImgSource=`https://content.${onCompetitiveCyclist?"competitivecyclist":"backcountry"}.com${imageSrc}`;newPLPSelectorDropdownOption.onmouseenter=()=>{if(productListingImg.src!==newImgSource){productListingImg.src=newImgSource}};newPLPSelectorDropdownOption.onclick=()=>{highlightCurrSelectedOption();if(productListingPrice.firstChild.textContent!==price&&!props.variantSelected){while(productListingPrice.lastChild){productListingPrice.lastChild.remove()}productListingPrice.append(HTMLElem("span",["ui-pl-pricing__high-price","ui-pl-pricing--price-retail","js-item-price-high","qa-item-price-high"],null,price));props.variantSelected=true}else{productListingPrice.firstChild.textContent=price}navigator.clipboard.writeText(SKU);currentOption.classList.toggle("copy-notif");currentOption.textContent="SKU Copied!";setTimeout(()=>{currentOption.classList.toggle("copy-notif");currentOption.textContent=variant},300)};return newPLPSelectorDropdownOption};const runOnAllElemsofClass=(elemClassName,func)=>{const elems=[...document.getElementsByClassName(elemClassName)];for(const elem of elems){func(elem)}};const deleteAllElemsOfClass=elemClassName=>{runOnAllElemsofClass(elemClassName,elem=>elem.remove())};const fixBCStyling=()=>{deleteAllElemsOfClass("js-pl-focus-trigger");deleteAllElemsOfClass("js-pl-color-thumbs");deleteAllElemsOfClass("js-pl-sizes-wrap");runOnAllElemsofClass("js-pl-expandable",({style:style})=>{style.top="10px";style.left="10px";style.right="10px";style.bottom="10px"})};const PLPWidgetContainer=(productID,productListing)=>{const newPLPWidgetContainer=HTMLElem("div",["plp-widget-container"]);newPLPWidgetContainer.append(PLPSelectorDropdownContainer(productID,productListing),WMSLink(productID));return newPLPWidgetContainer};const addPLPSingleWidget=productListing=>{const productID=productListing.parentElement.getAttribute("data-product-id");const targetLocation=productListing.childNodes[2];targetLocation.append(PLPWidgetContainer(productID,targetLocation))};const addAllPLPWidgets=()=>{if(!onCompetitiveCyclist){fixBCStyling()}runOnAllElemsofClass("js-pli-wrap",addPLPSingleWidget)};if(onPLP){addAllPLPWidgets();const targetNode=document.getElementsByClassName(onCompetitiveCyclist?"js-inner-body":"inner-body")[0];new MutationObserver(()=>{addAllPLPWidgets()}).observe(targetNode,{childList:true})}