const siteInfo={onCompetitiveCyclist:window.location.host==="www.competitivecyclist.com",siteString:window.location.host==="www.competitivecyclist.com"?"cc":"bc",onPLP:document.getElementsByClassName("search-results").length,onPDP:document.getElementsByClassName("js-kraken-pdp-body").length};const{onCompetitiveCyclist:onCompetitiveCyclist,onPLP:onPLP,onPDP:onPDP}=siteInfo;if(onPLP||onPDP){chrome.runtime.sendMessage({onCompetitiveCyclist:onCompetitiveCyclist})}const HTMLElem=(tagName,classList,id,textContent)=>{const newHTMLElem=document.createElement(tagName);if(classList){if(Array.isArray(classList)){newHTMLElem.classList.add(...classList)}else{throw new TypeError("Expected an array")}}if(id){newHTMLElem.id=id}if(textContent){newHTMLElem.textContent=textContent}return newHTMLElem};const WMSLink=(productID,siteInfo)=>{const newWMSLink=HTMLElem("a",classnamesForElem("WMSLink",siteInfo),null,"Go to WMS");newWMSLink.setAttribute("type","button");newWMSLink.href=`https://manager.backcountry.com/manager/admin/item_inventory.html?item_id=${productID}`;return newWMSLink};const classnamesForElem=(elem,siteInfo)=>{const classnames=[siteInfo.siteString];const add=(...classes)=>{classnames.push(...classes)};if(elem==="WMSLink"||elem==="CopySKUButton"){add("btn","btn-reset");if(siteInfo.onPDP){add("pdp");if(siteInfo.onCompetitiveCyclist){add("btn--secondary")}else{add("product-buybox__btn")}}else{add("plp")}}if(elem==="WMSLink"){add("link-to-wms")}if(elem==="PLPPrice"){add("ui-pl-pricing__high-price","ui-pl-pricing--price-retail","js-item-price-high","qa-item-price-high")}return classnames};const copySKUButtonOnClick=({currentTarget:copySKUButton})=>{const SKU=document.getElementsByClassName("js-selected-product-variant")[0].value;if(SKU){navigator.clipboard.writeText(SKU);copySKUButton.textContent="Copied!";copySKUButton.classList.add("flash");setTimeout(()=>{copySKUButton.classList.remove("flash")},100)}else{copySKUButton.textContent="Choose Item";copySKUButton.classList.add("no-variant-selected")}};const copySKUButtonOnMouseLeave=({currentTarget:copySKUButton})=>{copySKUButton.textContent="Copy SKU";copySKUButton.classList.remove("no-variant-selected")};const addMethodsToCopySKUButton=copySKUButton=>{copySKUButton.onmouseleave=copySKUButtonOnMouseLeave;copySKUButton.onclick=copySKUButtonOnClick};const copySKUButton=siteInfo=>{const newCopySKUButton=HTMLElem("button",classnamesForElem("CopySKUButton",siteInfo),"copy-sku-button","Copy SKU");newCopySKUButton.setAttribute("type","button");addMethodsToCopySKUButton(newCopySKUButton);return newCopySKUButton};const addOOSAlertToCCPDP=()=>{for(const dropdownOption of document.getElementsByClassName("js-unifiedropdown-option")){const SKU=dropdownOption.getAttribute("sku-value");if(SKU&&!BC.product.skusCollection[SKU].inventory){dropdownOption.classList.add("oos-alert")}}};const anonFuncToStr=func=>func.toString().slice(5,-1);const invokeFuncInWindow=func=>{const scriptElem=HTMLElem("script",null,null,anonFuncToStr(func));document.head.append(scriptElem);scriptElem.remove()};const PDPTargetLocation=siteInfo=>{const[targetLocation]=document.getElementsByClassName(siteInfo.onCompetitiveCyclist?"add-to-cart":"js-buybox-actions");return targetLocation};const PDPProductID=()=>{const{value:productID}=document.querySelector('[name ="/atg/commerce/order/purchase/CartModifierFormHandler.productId"]');return productID};const BCDropdownCaret=()=>{const newBCDropdownCaret=document.createElementNS("http://www.w3.org/2000/svg","svg");newBCDropdownCaret.classList.add("bc-dropdown-caret");newBCDropdownCaret.setAttribute("viewBox","0 0 256 256");const svgPath=document.createElementNS("http://www.w3.org/2000/svg","path");svgPath.setAttribute("d","M203.628 107.72c-5.613 5.9-64.759 63.566-64.759 63.566-3.007 3.149-6.939 4.714-10.87 4.714-3.945 0-7.876-1.567-10.87-4.714 0 0-59.145-57.665-64.773-63.565-5.613-5.9-6-16.501 0-22.812 6.014-6.296 14.386-6.79 21.738 0l53.905 52.908 53.891-52.894c7.365-6.79 15.752-6.296 21.738 0 6.014 6.296 5.641 16.912 0 22.797z");svgPath.classList.add("caret-path");newBCDropdownCaret.append(svgPath);return newBCDropdownCaret};const PLPDropdownOpened=target=>{const[elementClass]=target.classList;return elementClass==="plp-dropdown-options"};const openPLPDropdownOptions=(event,productID,productListing,siteInfo)=>{if(siteInfo.onCompetitiveCyclist)event.stopPropagation();const{currentTarget:currentTarget}=event;const{firstChild:currentOption,lastChild:lastChild}=currentTarget;if(PLPDropdownOpened(lastChild)){lastChild.classList.toggle("hidden")}else{currentTarget.append(PLPSelectorDropdown(productID,currentOption,productListing,siteInfo))}};const closePLPDropdownOptions=PLPSelectorDropdownContainer=>{const{lastChild:lastChild}=PLPSelectorDropdownContainer;if(PLPDropdownOpened(lastChild)){lastChild.classList.add("hidden")}};const handleDropdownOptions=(productID,productListing,PLPSelectorDropdownContainer,siteInfo)=>{PLPSelectorDropdownContainer.onclick=event=>openPLPDropdownOptions(event,productID,productListing,siteInfo);productListing.onmouseleave=()=>closePLPDropdownOptions(PLPSelectorDropdownContainer)};const PLPDropdownCurrentOption=siteString=>HTMLElem("div",["plp-dropdown-current-option",siteString],null,"Select option");const PLPSelectorDropdownContainer=(productID,productListing,siteInfo)=>{const{siteString:siteString,onCompetitiveCyclist:onCompetitiveCyclist}=siteInfo;const newPLPSelectorDropdownContainer=HTMLElem("div",["plp-dropdown-container",siteString]);newPLPSelectorDropdownContainer.append(PLPDropdownCurrentOption(siteString));if(!onCompetitiveCyclist){newPLPSelectorDropdownContainer.append(BCDropdownCaret())}handleDropdownOptions(productID,productListing,newPLPSelectorDropdownContainer,siteInfo);return newPLPSelectorDropdownContainer};const getItemInfo=async(productID,{onCompetitiveCyclist:onCompetitiveCyclist})=>{try{let res=await fetch(`https://api.backcountry.com/v1/products/${productID}?fields=skus.availability.stockLevel,skus.title,skus.id,skus.salePrice,skus.image&site=${onCompetitiveCyclist?"competitivecyclist":"bcs"}`);res=await res.json();return Promise.resolve(await res.products[0].skus)}catch(err){console.log(err)}};const usdString=num=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(num);const formatProduct=({salePrice:salePrice,id:id,availability:{stockLevel:stockLevel},title:title,image:{url:url}})=>({price:usdString(salePrice),SKU:id,outOfStock:!stockLevel,variant:title,imageSrc:url});const highlightCurrSelectedOption=(PLPSelectorDropdown,selectedIdx,state)=>{const toggleCurrOptionClass=()=>{PLPSelectorDropdown.childNodes[state.currentlySelectedOptionIdx].classList.toggle("curr-selected-option")};if(state.currentlySelectedOptionIdx>=0){toggleCurrOptionClass()}state.currentlySelectedOptionIdx=selectedIdx;toggleCurrOptionClass()};const getProductListingElems=productListing=>{const[productListingImg]=productListing.getElementsByTagName("img");const[productListingPrice]=productListing.getElementsByClassName("js-pl-pricing");return[productListingImg,productListingPrice]};const PLPSelectorDropdown=(productID,currentOption,productListing,siteInfo)=>{const newPLPSelectorDropdown=HTMLElem("ul",["plp-dropdown-options",siteInfo.siteString]);const state={variantSelected:false,currentlySelectedOptionIdx:-1};getItemInfo(productID,siteInfo).then(products=>{for(let i=0;i<products.length;i+=1){newPLPSelectorDropdown.append(PLPSelectorDropdownOption(formatProduct(products[i]),state,currentOption,getProductListingElems(productListing),()=>highlightCurrSelectedOption(newPLPSelectorDropdown,i,state),siteInfo))}});return newPLPSelectorDropdown};const updatePricingPLP=(productListingPrice,props,price,siteInfo)=>{if(productListingPrice.firstChild.textContent!==price&&!props.variantSelected){while(productListingPrice.lastChild){productListingPrice.lastChild.remove()}productListingPrice.append(HTMLElem("span",classnamesForElem("PLPPrice",siteInfo),null,price));props.variantSelected=true}else{productListingPrice.firstChild.textContent=price}};const copySKUPLP=(currentOption,variant,SKU)=>{navigator.clipboard.writeText(SKU);currentOption.classList.toggle("copy-notif");currentOption.textContent="SKU Copied!";setTimeout(()=>{currentOption.classList.toggle("copy-notif");currentOption.textContent=variant},300)};const addMethodsToPLPSelectorDropdownOption=(PLPSelectorDropdownOption,{price:price,SKU:SKU,outOfStock:outOfStock,variant:variant,imageSrc:imageSrc},props,currentOption,[productListingImg,productListingPrice],highlightCurrSelectedOption,siteInfo)=>{if(outOfStock)PLPSelectorDropdownOption.classList.add("oos-alert");PLPSelectorDropdownOption.onmouseenter=()=>{const newImgSource=`https://content.${siteInfo.onCompetitiveCyclist?"competitivecyclist":"backcountry"}.com${imageSrc}`;if(productListingImg.src!==newImgSource){productListingImg.src=newImgSource}};PLPSelectorDropdownOption.onclick=()=>{highlightCurrSelectedOption();updatePricingPLP(productListingPrice,props,price);copySKUPLP(currentOption,variant,SKU)}};const PLPSelectorDropdownOption=(product,...params)=>{const{variant:variant,price:price}=product;const newPLPSelectorDropdownOption=HTMLElem("li",["plp-dropdown-option-single"],null,`${variant} (${price})`);addMethodsToPLPSelectorDropdownOption(newPLPSelectorDropdownOption,product,...params);return newPLPSelectorDropdownOption};const runOnAllElemsOfClass=(elemClassName,func)=>{const elems=[...document.getElementsByClassName(elemClassName)];for(const elem of elems){func(elem)}};const deleteAllElemsOfClass=elemClassName=>{runOnAllElemsOfClass(elemClassName,elem=>elem.remove())};const fixBCStyling=()=>{deleteAllElemsOfClass("js-pl-focus-trigger");deleteAllElemsOfClass("js-pl-color-thumbs");deleteAllElemsOfClass("js-pl-sizes-wrap");runOnAllElemsOfClass("js-pl-expandable",({style:style})=>{style.top="10px";style.right="10px";style.bottom="10px";style.left="10px"})};const CCNewTabFix=({currentTarget:currentTarget})=>{window.open(currentTarget.getAttribute("data-url"))};const PLPWidgetContainer=(productID,productListing,siteInfo)=>{const newPLPWidgetContainer=HTMLElem("div",["plp-widget-container"]);newPLPWidgetContainer.append(PLPSelectorDropdownContainer(productID,productListing,siteInfo),WMSLink(productID,siteInfo));return newPLPWidgetContainer};const addPLPSingleWidget=(productListing,siteInfo)=>{const productID=productListing.getAttribute("data-product-id");const targetLocation=productListing.firstChild.childNodes[2];if(siteInfo.onCompetitiveCyclist){targetLocation.onauxclick=CCNewTabFix}targetLocation.append(PLPWidgetContainer(productID,targetLocation,siteInfo))};const addAllPLPWidgets=siteInfo=>{if(!onCompetitiveCyclist){fixBCStyling()}runOnAllElemsOfClass("js-product-listing",productListing=>addPLPSingleWidget(productListing,siteInfo))};const nodeToObservePLP=()=>{const[nodeToObserve]=document.getElementsByClassName(onCompetitiveCyclist?"js-inner-body":"inner-body");return nodeToObserve};if(onPDP){if(onCompetitiveCyclist)invokeFuncInWindow(addOOSAlertToCCPDP);PDPTargetLocation(siteInfo).append(WMSLink(PDPProductID(),siteInfo),copySKUButton(siteInfo))}if(onPLP){addAllPLPWidgets(siteInfo);new MutationObserver(()=>addAllPLPWidgets(siteInfo)).observe(nodeToObservePLP(),{childList:true})}