const t={onCompetitiveCyclist:"www.competitivecyclist.com"===window.location.host,siteString:"www.competitivecyclist.com"===window.location.host?"cc":"bc",onPLP:document.getElementsByClassName("search-results").length,onPDP:document.getElementsByClassName("js-kraken-pdp-body").length},{onCompetitiveCyclist:e,onPLP:o,onPDP:n}=t;(o||n)&&chrome.runtime.sendMessage({onCompetitiveCyclist:e});const s=(t,e,o,n)=>{const s=document.createElement(t);return e&&s.classList.add(...e),o&&(s.id=o),n&&(s.textContent=n),s},i=(t,e)=>{const o=s("a",r("WMSLink",e),null,"Go to WMS");return o.setAttribute("type","button"),o.href="https://manager.backcountry.com/manager/admin/item_inventory.html?item_id="+t,o},r=(t,e)=>{const o=[e.siteString],n=(...t)=>{o.push(...t)};return"WMSLink"!==t&&"CopySKUButton"!==t||(n("btn","btn-reset"),e.onPDP?(n("pdp"),e.onCompetitiveCyclist?n("btn--secondary"):n("product-buybox__btn")):n("plp")),"WMSLink"===t&&n("link-to-wms"),"PLPPrice"===t&&n("ui-pl-pricing__high-price","ui-pl-pricing--price-retail","js-item-price-high","qa-item-price-high"),o},c=({currentTarget:t})=>{const e=document.getElementsByClassName("js-selected-product-variant")[0].value;e?(navigator.clipboard.writeText(e),t.textContent="Copied!",t.classList.add("flash"),setTimeout(()=>{t.classList.remove("flash")},100)):(t.textContent="Choose Item",t.classList.add("no-variant-selected"))},l=({currentTarget:t})=>{t.textContent="Copy SKU",t.classList.remove("no-variant-selected")},a=t=>{t.onmouseleave=l,t.onclick=c},p=t=>{const e=s("button",r("CopySKUButton",t),"copy-sku-button","Copy SKU");return e.setAttribute("type","button"),a(e),e},d=()=>{for(const t of document.getElementsByClassName("js-unifiedropdown-option")){const e=t.getAttribute("sku-value");e&&!BC.product.skusCollection[e].inventory&&t.classList.add("oos-alert")}},u=t=>t.toString().slice(5,-1),m=t=>{const e=s("script",null,null,u(t));document.head.append(e),e.remove()},g=t=>{const[e]=document.getElementsByClassName(t.onCompetitiveCyclist?"add-to-cart":"js-buybox-actions");return e},y=()=>{const{value:t}=document.querySelector('[name ="/atg/commerce/order/purchase/CartModifierFormHandler.productId"]');return t};n&&(e&&m(d),g(t).append(i(y(),t),p(t)));const C=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("bc-dropdown-caret"),t.setAttribute("viewBox","0 0 256 256");const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("d","M203.628 107.72c-5.613 5.9-64.759 63.566-64.759 63.566-3.007 3.149-6.939 4.714-10.87 4.714-3.945 0-7.876-1.567-10.87-4.714 0 0-59.145-57.665-64.773-63.565-5.613-5.9-6-16.501 0-22.812 6.014-6.296 14.386-6.79 21.738 0l53.905 52.908 53.891-52.894c7.365-6.79 15.752-6.296 21.738 0 6.014 6.296 5.641 16.912 0 22.797z"),e.classList.add("caret-path"),t.append(e),t},v=t=>{const[e]=t.classList;return"plp-dropdown-options"===e},h=(t,e,o,n)=>{n.onCompetitiveCyclist&&t.stopPropagation();const{currentTarget:s}=t,{firstChild:i,lastChild:r}=s;v(r)?r.classList.toggle("hidden"):s.append(N(e,i,o,n))},b=t=>{const{lastChild:e}=t;v(e)&&e.classList.add("hidden")},w=(t,e,o,n)=>{o.onclick=o=>h(o,t,e,n),e.onmouseleave=()=>b(o)},S=t=>s("div",["plp-dropdown-current-option",t],null,"Select option"),f=(t,e,o)=>{const{siteString:n,onCompetitiveCyclist:i}=o,r=s("div",["plp-dropdown-container",n]);return r.append(S(n)),i||r.append(C()),w(t,e,r,o),r},x=async(t,{onCompetitiveCyclist:e})=>{try{let o=await fetch(`https://api.backcountry.com/v1/products/${t}?fields=skus.availability.stockLevel,skus.title,skus.id,skus.salePrice,skus.image&site=${e?"competitivecyclist":"bcs"}`);return o=await o.json(),Promise.resolve(await o.products[0].skus)}catch(t){console.log(t)}},k=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t),L=({salePrice:t,id:e,availability:{stockLevel:o},title:n,image:{url:s}})=>{return{price:(i=t,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(i)),SKU:e,outOfStock:!o,variant:n,imageSrc:s};var i},P=(t,e,o)=>{const n=()=>{t.childNodes[o.currentlySelectedOptionIdx].classList.toggle("curr-selected-option")};o.currentlySelectedOptionIdx>=0&&n(),o.currentlySelectedOptionIdx=e,n()},j=t=>{const[e]=t.getElementsByTagName("img"),[o]=t.getElementsByClassName("js-pl-pricing");return[e,o]},N=(t,e,o,n)=>{const i=s("ul",["plp-dropdown-options",n.siteString]),r={variantSelected:!1,currentlySelectedOptionIdx:-1};return x(t,n).then(t=>{for(let s=0;s<t.length;s+=1)i.append(T(L(t[s]),r,e,j(o),()=>P(i,s,r),n))}),i},B=(t,e,o,n)=>{if(t.firstChild.textContent===o||e.variantSelected)t.firstChild.textContent=o;else{for(;t.lastChild;)t.lastChild.remove();t.append(s("span",r("PLPPrice",n),null,o)),e.variantSelected=!0}},E=(t,e,o)=>{navigator.clipboard.writeText(o),t.classList.toggle("copy-notif"),t.textContent="SKU Copied!",setTimeout(()=>{t.classList.toggle("copy-notif"),t.textContent=e},300)},U=(t,{price:e,SKU:o,outOfStock:n,variant:s,imageSrc:i},r,c,[l,a],p,d)=>{n&&t.classList.add("oos-alert"),t.onmouseenter=()=>{const t=`https://content.${d.onCompetitiveCyclist?"competitivecyclist":"backcountry"}.com${i}`;l.src!==t&&(l.src=t)},t.onclick=()=>{p(),B(a,r,e),E(c,s,o)}},T=(t,...e)=>{const{variant:o,price:n}=t,i=s("li",["plp-dropdown-option-single"],null,`${o} (${n})`);return U(i,t,...e),i},I=(t,e)=>{const o=[...document.getElementsByClassName(t)];for(const t of o)e(t)},M=t=>{I(t,t=>t.remove())},A=()=>{M("js-pl-focus-trigger"),M("js-pl-color-thumbs"),M("js-pl-sizes-wrap"),I("js-pl-expandable",({style:t})=>{t.top="10px",t.left="10px",t.right="10px",t.bottom="10px"})},D=({currentTarget:t})=>{window.open(t.getAttribute("data-url"))},K=(t,e,o)=>{const n=s("div",["plp-widget-container"]);return n.append(f(t,e,o),i(t,o)),n},O=(t,e)=>{const o=t.getAttribute("data-product-id"),n=t.firstChild.childNodes[2];e.onCompetitiveCyclist&&(n.onauxclick=D),n.append(K(o,n,e))},$=t=>{e||(M("js-pl-focus-trigger"),M("js-pl-color-thumbs"),M("js-pl-sizes-wrap"),I("js-pl-expandable",({style:t})=>{t.top="10px",t.left="10px",t.right="10px",t.bottom="10px"})),I("js-product-listing",e=>O(e,t))},_=()=>{const[t]=document.getElementsByClassName(e?"js-inner-body":"inner-body");return t};o&&($(t),new MutationObserver(()=>$(t)).observe(_(),{childList:!0}));