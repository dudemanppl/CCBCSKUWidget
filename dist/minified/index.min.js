const t="www.competitivecyclist.com"===window.location.host,e=t?"cc":"bc",n=document.getElementsByClassName("search-results").length,s=document.getElementsByClassName("js-kraken-pdp-body").length;chrome.runtime.sendMessage({onCompetitiveCyclist:t});const o=(t,e,n,s)=>{const o=document.createElement(t);if(e){if(!Array.isArray(e))throw new TypeError("Expected an array");o.classList.add(...e)}return n&&(o.id=n),s&&(o.textContent=s),o},r=t=>{const e=o("a",i("WMSLink"),null,"Go to WMS");return e.setAttribute("type","button"),e.href="https://manager.backcountry.com/manager/admin/item_inventory.html?item_id="+t,e},i=n=>{const o=[e],r=(...t)=>{o.push(...t)};return"WMSLink"!==n&&"CopySKUButton"!==n||(r("btn","btn-reset"),s?(r("pdp"),r(t?"btn--secondary":"product-buybox__btn")):r("plp")),"WMSLink"===n&&r("link-to-wms"),"PLPPrice"===n&&r("ui-pl-pricing__high-price","ui-pl-pricing--price-retail","js-item-price-high","qa-item-price-high"),o},c=({currentTarget:t})=>{const e=document.getElementsByClassName("js-selected-product-variant")[0].value;e?(navigator.clipboard.writeText(e),t.textContent="Copied!",t.classList.add("flash"),setTimeout(()=>{t.classList.remove("flash")},100)):(t.textContent="Choose Item",t.classList.add("no-variant-selected"))},a=({currentTarget:t})=>{t.textContent="Copy SKU",t.classList.remove("no-variant-selected")},l=t=>{t.onmouseleave=a,t.onclick=c},p=()=>{const t=o("button",i("CopySKUButton"),"copy-sku-button","Copy SKU");return t.setAttribute("type","button"),l(t),t},d=()=>{for(const t of document.getElementsByClassName("js-unifiedropdown-option")){const e=t.getAttribute("sku-value");e&&!BC.product.skusCollection[e].inventory&&t.classList.add("oos-alert")}},u=t=>t.toString().slice(5,-1),m=t=>{const e=o("script",null,null,u(t));document.head.append(e),e.remove()},g=()=>{const[e]=document.getElementsByClassName(t?"add-to-cart":"js-buybox-actions");return e},y=()=>{const{value:t}=document.querySelector('[name ="/atg/commerce/order/purchase/CartModifierFormHandler.productId"]');return t};s&&(t&&m(d),g().append(r(y()),p()));const h=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("bc-dropdown-caret"),t.setAttribute("viewBox","0 0 256 256");const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("d","M203.628 107.72c-5.613 5.9-64.759 63.566-64.759 63.566-3.007 3.149-6.939 4.714-10.87 4.714-3.945 0-7.876-1.567-10.87-4.714 0 0-59.145-57.665-64.773-63.565-5.613-5.9-6-16.501 0-22.812 6.014-6.296 14.386-6.79 21.738 0l53.905 52.908 53.891-52.894c7.365-6.79 15.752-6.296 21.738 0 6.014 6.296 5.641 16.912 0 22.797z"),e.classList.add("caret-path"),t.append(e),t},v=({classList:[t]})=>"plp-dropdown-options"===t,b=async(t,e,n)=>{const{currentTarget:s}=t,{firstChild:o,lastChild:r}=s;v(r)?r.classList.toggle("hidden"):s.append(await T(e,o,n))},w=t=>{const{lastChild:e}=t;v(e)&&e.classList.add("hidden")},C=(t,e,n)=>{n.onclick=n=>b(n,t,e),e.onmouseleave=()=>w(n)},S=t=>o("div",["plp-dropdown-current-option",t],null,"Select option"),f=(n,s)=>{const r=o("div",["plp-dropdown-container",e]);return r.append(S(e)),t||r.append(h()),C(n,s,r),r},x=async t=>(await fetch(t)).json(),k=async e=>{const n=`https://api.backcountry.com/v1/products/${e}?fields=skus.availability.stockLevel,skus.title,skus.id,skus.salePrice,skus.image&site=${t?"competitivecyclist":"bcs"}`;return await x(n)},L=async t=>{const e=await k(t),{products:[{skus:n}]}=e;return n},j=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t),E=({salePrice:t,id:e,availability:{stockLevel:n},title:s,image:{url:o}})=>{var r;return{price:(r=t,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(r)),SKU:e,outOfStock:!n,variant:s,imageSrc:o}},N=(t,e)=>{t.childNodes[e.currentlySelectedOptionIdx].classList.toggle("curr-selected-option")},B=(t,e,n)=>{n!==e.currentlySelectedOptionIdx&&(e.currentlySelectedOptionIdx>=0&&N(t,e),e.currentlySelectedOptionIdx=n,N(t,e))},U=t=>{const[e]=t.getElementsByTagName("img"),[n]=t.getElementsByClassName("js-pl-pricing");return[e,n]},I=async(t,e,n,s,o)=>(await L(t)).map((t,r)=>P(E(t),s,e,U(n),()=>B(o,s,r))),T=async(...t)=>{const n=o("ul",["plp-dropdown-options",e]),s=await I(...t,{variantSelected:!1,currentlySelectedOptionIdx:-1},n);return n.append(...s),n},A=(t,e,n)=>{const{variantSelected:s}=e;if(t.firstChild.textContent!==n&&s)t.firstChild.textContent=n;else if(!s){for(;t.lastChild;)t.lastChild.remove();t.append(o("span",i("PLPPrice"),null,n)),e.variantSelected=!0}},M=(t,e,n)=>{navigator.clipboard.writeText(n),t.classList.toggle("copy-notif"),t.textContent="SKU Copied!",setTimeout(()=>{t.classList.toggle("copy-notif"),t.textContent=e},300)},O=(e,{price:n,SKU:s,outOfStock:o,variant:r,imageSrc:i},c,a,[l,p],d)=>{o&&e.classList.add("oos-alert"),e.onmouseenter=()=>{const e=`https://content.${t?"competitivecyclist":"backcountry"}.com${i}`;l.src!==e&&(l.src=e)},e.onclick=()=>{d(),A(p,c,n),M(a,r,s)}},P=(t,...e)=>{const{variant:n,price:s}=t,r=o("li",["plp-dropdown-option-single"],null,`${n} (${s})`);return O(r,t,...e),r},K=(t,e)=>{const n=[...document.getElementsByClassName(t)];for(const t of n)e(t)},$=t=>{K(t,t=>t.remove())},_=()=>{$("js-pl-focus-trigger"),$("js-pl-color-thumbs"),$("js-pl-sizes-wrap"),K("js-pl-expandable",({style:t})=>{t.top="10px",t.right="10px",t.bottom="10px",t.left="10px"})},F=(t,e)=>{const n=o("div",["plp-widget-container"]);return n.append(f(t,e),r(t)),n},D=t=>{const e=t.getAttribute("data-product-id"),n=t.firstChild;n.append(F(e,n))},W=()=>{t||($("js-pl-focus-trigger"),$("js-pl-color-thumbs"),$("js-pl-sizes-wrap"),K("js-pl-expandable",({style:t})=>{t.top="10px",t.right="10px",t.bottom="10px",t.left="10px"})),K("js-product-listing",t=>D(t))},z=()=>{const[e]=document.getElementsByClassName(t?"js-inner-body":"inner-body");return e};n&&(W(),new MutationObserver(()=>W()).observe(z(),{childList:!0}));