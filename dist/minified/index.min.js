const t="www.competitivecyclist.com"===window.location.host,e=t?"cc":"bc",o=document.getElementsByClassName("search-results").length,n=document.getElementsByClassName("js-kraken-pdp-body").length;chrome.runtime.sendMessage({onCompetitiveCyclist:t});const s=(t,e,o,n)=>{const s=document.createElement(t);return e&&s.classList.add(...e),o&&(s.id=o),n&&(s.textContent=n),s},r=t=>{const e=s("a",c("WMSLink"),null,"Go to WMS");return e.setAttribute("type","button"),e.href="https://manager.backcountry.com/manager/admin/item_inventory.html?item_id="+t,e},c=o=>{const s=[e],r=(...t)=>{s.push(...t)};return"WMSLink"!==o&&"CopySKUButton"!==o||(r("btn","btn-reset"),n?(r("pdp"),r(t?"btn--secondary":"product-buybox__btn")):r("plp")),"WMSLink"===o&&r("link-to-wms"),"PLPPrice"===o&&r("ui-pl-pricing__high-price","ui-pl-pricing--price-retail","js-item-price-high","qa-item-price-high"),s},i=({currentTarget:t})=>{const e=document.getElementsByClassName("js-selected-product-variant")[0].value;e?(navigator.clipboard.writeText(e),t.textContent="Copied!",t.classList.add("flash"),setTimeout(()=>{t.classList.remove("flash")},100)):(t.textContent="Choose Item",t.classList.add("no-variant-selected"))},a=({currentTarget:t})=>{t.textContent="Copy SKU",t.classList.remove("no-variant-selected")},l=t=>{t.onmouseleave=a,t.onclick=i},p=()=>{const t=s("button",c("CopySKUButton"),"copy-sku-button","Copy SKU");return t.setAttribute("type","button"),l(t),t},d=()=>{const t=s("script",null,null,'for(const a of document.getElementsByClassName("js-unifiedropdown-option")){const b=a.getAttribute("sku-value");b&&!BC.product.skusCollection[b].inventory&&a.classList.add("oos-alert")}');document.head.append(t),t.remove()},u=()=>document.getElementsByClassName(t?"add-to-cart":"js-buybox-actions")[0],m=()=>document.querySelector('[name ="/atg/commerce/order/purchase/CartModifierFormHandler.productId"]').value;n&&(t&&d(),document.getElementsByClassName(t?"add-to-cart":"js-buybox-actions")[0].append(r(document.querySelector('[name ="/atg/commerce/order/purchase/CartModifierFormHandler.productId"]').value),p()));const g=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("bc-dropdown-caret"),t.setAttribute("viewBox","0 0 256 256");const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("d","M203.628 107.72c-5.613 5.9-64.759 63.566-64.759 63.566-3.007 3.149-6.939 4.714-10.87 4.714-3.945 0-7.876-1.567-10.87-4.714 0 0-59.145-57.665-64.773-63.565-5.613-5.9-6-16.501 0-22.812 6.014-6.296 14.386-6.79 21.738 0l53.905 52.908 53.891-52.894c7.365-6.79 15.752-6.296 21.738 0 6.014 6.296 5.641 16.912 0 22.797z"),e.classList.add("caret-path"),t.append(e),t},y=(o,n)=>{const r=s("div",["plp-dropdown-container",e]),c=s("div",["plp-dropdown-current-option",e],null,"Select option");let i;return r.append(c,t?[]:g()),r.onclick=e=>{t&&e.stopPropagation(),i?i.classList.toggle("hidden"):(i=S(o,c,n),r.append(i))},n.onmouseleave=()=>{i&&i.classList.add("hidden")},r},b=async e=>{try{let o=await fetch(`https://api.backcountry.com/v1/products/${e}?fields=skus.availability.stockLevel,skus.title,skus.id,skus.salePrice,skus.image&site=${t?"competitivecyclist":"bcs"}`);return o=await o.json(),Promise.resolve(await o.products[0].skus)}catch(t){console.log(t)}},h=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t),v=({salePrice:t,id:e,availability:{stockLevel:o},title:n,image:{url:s}})=>{return{price:(r=t,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(r)),SKU:e,outOfStock:!o,variant:n,imageSrc:s};var r},C=(t,e,o)=>{const n=()=>{t.childNodes[o.currentlySelectedOptionIdx].classList.toggle("curr-selected-option")};o.currentlySelectedOptionIdx>=0&&n(),o.currentlySelectedOptionIdx=e,n()},w=t=>{const[e]=t.getElementsByTagName("img"),[o]=t.getElementsByClassName("js-pl-pricing");return[e,o]},S=(t,o,n)=>{const r=s("ul",["plp-dropdown-options",e]),c={variantSelected:!1,currentlySelectedOptionIdx:-1};return b(t).then(t=>{for(let e=0;e<t.length;e+=1)r.append(L(v(t[e]),c,o,w(n),()=>C(r,e,c)))}),r},f=(t,e,o)=>{if(t.firstChild.textContent===o||e.variantSelected)t.firstChild.textContent=o;else{for(;t.lastChild;)t.lastChild.remove();t.append(s("span",c("PLPPrice"),null,o)),e.variantSelected=!0}},x=(t,e,o)=>{navigator.clipboard.writeText(o),t.classList.toggle("copy-notif"),t.textContent="SKU Copied!",setTimeout(()=>{t.classList.toggle("copy-notif"),t.textContent=e},300)},k=(e,{price:o,SKU:n,outOfStock:s,variant:r,imageSrc:c},i,a,[l,p],d)=>{s&&e.classList.add("oos-alert"),e.onmouseenter=()=>{const e=`https://content.${t?"competitivecyclist":"backcountry"}.com${c}`;l.src!==e&&(l.src=e)},e.onclick=()=>{d(),f(p,i,o),x(a,r,n)}},L=(t,...e)=>{const{variant:o,price:n}=t,r=s("li",["plp-dropdown-option-single"],null,`${o} (${n})`);return k(r,t,...e),r},j=(t,e)=>{const o=[...document.getElementsByClassName(t)];for(const t of o)e(t)},N=t=>{j(t,t=>t.remove())},B=()=>{N("js-pl-focus-trigger"),N("js-pl-color-thumbs"),N("js-pl-sizes-wrap"),j("js-pl-expandable",({style:t})=>{t.top="10px",t.left="10px",t.right="10px",t.bottom="10px"})},E=(t,e)=>{const o=s("div",["plp-widget-container"]);return o.append(y(t,e),r(t)),o},U=t=>{const e=t.parentElement.getAttribute("data-product-id"),o=t.childNodes[2];o.append(E(e,o))},P=()=>{t||(N("js-pl-focus-trigger"),N("js-pl-color-thumbs"),N("js-pl-sizes-wrap"),j("js-pl-expandable",({style:t})=>{t.top="10px",t.left="10px",t.right="10px",t.bottom="10px"})),j("js-pli-wrap",U)};if(o){P();const e=document.getElementsByClassName(t?"js-inner-body":"inner-body")[0];new MutationObserver(()=>{P()}).observe(e,{childList:!0})}