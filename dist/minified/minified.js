const t="www.competitivecyclist.com"===window.location.host,e=t?"cc":"bc",o=document.getElementsByClassName("search-results").length,n=document.getElementsByClassName("js-kraken-pdp-body").length;chrome.runtime.sendMessage({onCompetitiveCyclist:t});const s=(t,e,o,n)=>{const s=document.createElement(t);return e&&s.classList.add(...e),o&&(s.id=o),n&&(s.textContent=n),s},c=o=>{const c=s("a",[...n?["pdp",t?"btn--secondary":"product-buybox__btn"]:["plp"],"link-to-wms","btn","btn-reset",e],null,"Go to WMS");return c.setAttribute("type","button"),c.href="https://manager.backcountry.com/manager/admin/item_inventory.html?item_id="+o,c};chrome.runtime.onMessage.addListener(({onCompetitiveCyclist:t},{tab:{id:e}})=>{chrome.pageAction.show(e),t||chrome.pageAction.setIcon({path:"images/bc.png",tabId:e})});const i=()=>{const o=s("button",[...t?["btn--secondary","buy-box__compare-btn"]:["product-buybox__btn"],"btn","btn-reset",e],"copy-sku-button","Copy SKU");return o.setAttribute("type","button"),o.onmouseleave=({currentTarget:t})=>{t.textContent="Copy SKU",t.classList.remove("no-variant-selected")},o.onclick=({currentTarget:t})=>{const e=document.getElementsByClassName("js-selected-product-variant")[0].value;e?(navigator.clipboard.writeText(e),t.textContent="Copied!",t.classList.add("flash"),setTimeout(()=>{t.classList.remove("flash")},100)):(t.textContent="Choose Item",t.classList.add("no-variant-selected"))},o},a=()=>{const t=s("script",null,null,(()=>{for(const t of document.getElementsByClassName("js-unifiedropdown-option")){const e=t.getAttribute("sku-value");e&&!BC.product.skusCollection[e].inventory&&t.classList.add("oos-alert")}}).toString());document.head.append(t),t.remove()};if(n){const e=t,o=document.querySelector('[name ="/atg/commerce/order/purchase/CartModifierFormHandler.productId"]').value,n=document.getElementsByClassName(e?"add-to-cart":"js-buybox-actions")[0];e&&a(),n.append(c(o),i())}const r=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("bc-dropdown-caret"),t.setAttribute("viewBox","0 0 256 256");const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("d","M203.628 107.72c-5.613 5.9-64.759 63.566-64.759 63.566-3.007 3.149-6.939 4.714-10.87 4.714-3.945 0-7.876-1.567-10.87-4.714 0 0-59.145-57.665-64.773-63.565-5.613-5.9-6-16.501 0-22.812 6.014-6.296 14.386-6.79 21.738 0l53.905 52.908 53.891-52.894c7.365-6.79 15.752-6.296 21.738 0 6.014 6.296 5.641 16.912 0 22.797z"),e.classList.add("caret-path"),t.append(e),t},l=(o,n)=>{const c=s("div",["plp-dropdown-container",e]),i=s("div",["plp-dropdown-current-option",e],null,"Select option");let a;return c.append(i,t?[]:r()),c.onclick=e=>{t&&e.stopPropagation(),a?a.classList.toggle("hidden"):(a=p(o,i,n),c.append(a))},n.onmouseleave=()=>{a&&a.classList.add("hidden")},c},d=async e=>{try{let o=await fetch(`https://api.backcountry.com/v1/products/${e}?fields=skus.availability.stockLevel,skus.title,skus.id,skus.salePrice,skus.image&site=${t?"competitivecyclist":"bcs"}`);return o=await o.json(),Promise.resolve(await o.products[0].skus)}catch(t){console.log(t)}},p=(t,o,n)=>{const c=s("ul",["plp-dropdown-options",e]),i={variantSelected:!1};let a;const r=t=>{const e=()=>{c.childNodes[a].classList.toggle("curr-selected-option")};a>=0&&e(),a=t,e()};return d(t).then(t=>{const e=n.getElementsByTagName("img")[0],s=n.getElementsByClassName("js-pl-pricing")[0];for(let n=0;n<t.length;n+=1){const a=t[n],l={price:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(a.salePrice),SKU:a.id,outOfStock:!a.availability.stockLevel,variant:a.title,imageSrc:a.image.url};c.append(u(l,i,o,e,s,()=>r(n)))}}),c},u=({price:e,SKU:o,outOfStock:n,variant:c,imageSrc:i},a,r,l,d,p)=>{const u=s("li",["plp-dropdown-option-single"],null,`${c} (${e})`);n&&u.classList.add("oos-alert");const m=`https://content.${t?"competitivecyclist":"backcountry"}.com${i}`;return u.onmouseenter=()=>{l.src!==m&&(l.src=m)},u.onclick=()=>{if(p(),d.firstChild.textContent===e||a.variantSelected)d.firstChild.textContent=e;else{for(;d.lastChild;)d.lastChild.remove();d.append(s("span",["ui-pl-pricing__high-price","ui-pl-pricing--price-retail","js-item-price-high","qa-item-price-high"],null,e)),a.variantSelected=!0}navigator.clipboard.writeText(o),r.classList.toggle("copy-notif"),r.textContent="SKU Copied!",setTimeout(()=>{r.classList.toggle("copy-notif"),r.textContent=c},300)},u},m=(t,e)=>{const o=[...document.getElementsByClassName(t)];for(const t of o)e(t)},g=t=>{m(t,t=>t.remove())},b=(t,e)=>{const o=s("div",["plp-widget-container"]);return o.append(l(t,e),c(t)),o},h=()=>{t||(g("js-pl-focus-trigger"),g("js-pl-color-thumbs"),g("js-pl-sizes-wrap"),m("js-pl-expandable",({style:t})=>{t.top="10px",t.left="10px",t.right="10px",t.bottom="10px"})),m("js-pli-wrap",t=>{const e=t.parentElement.getAttribute("data-product-id"),o=t.childNodes[2];o.append(b(e,o))})};if(o){h();const e=document.getElementsByClassName(t?"js-inner-body":"inner-body")[0];new MutationObserver(()=>{h()}).observe(e,{childList:!0})}